---
import { getCollection } from "astro:content";

import FloatingNav from "@/components/FloatingNav.astro";
import Footer from "@/components/Footer.astro";
import FullscreenNav from "@/components/FullscreenNav.astro";
import Head from "@/components/Head.astro";
import SkipLink from "@/components/SkipLink.astro";
import { DESCRIPTIONS, TITLES, URLS } from "@/constants";
import { getTagsWithWritings } from "@/utils/data";

const allWritings = await getCollection("writing");

// TODO: Update design when tags reach
// TODO: Update alphabetical order to writings.length
const tagsWithWritings = getTagsWithWritings(allWritings).sort((a, b) =>
  a.tag.localeCompare(b.tag)
);
---

<!doctype html>
<html lang="en">
  <head>
    <Head title={TITLES.tags} description={DESCRIPTIONS.tags} />
  </head>

  <body>
    <SkipLink />
    <main id="main-content">
      <section class="container" aria-label="All tags">
        <h1 class="heading">Tags</h1>

        <ul class="tag-list" role="list">
          {
            tagsWithWritings.map(({ tag, writings }) => (
              <li class="tag-item">
                <a href={URLS.tag(tag)} class="tag-link">
                  <span class="tag-name">{tag}</span>
                  <span class="tag-count">
                    Has <strong>{writings.length}</strong> writings
                  </span>
                </a>
              </li>
            ))
          }
        </ul>
      </section>
    </main>
    <FloatingNav />
    <FullscreenNav />
    <Footer />
  </body>
</html>

<style>
  /* -------------------------
   * Theme — Local Variables
   * ------------------------- */
  :root {
    --tags-padding-y: 15rem;
    --tags-content-width: 36rem;
  }

  /* -------------------------
   * Layout — Page Container
   * ------------------------- */
  .container {
    margin-inline: auto;
    padding-block: var(--tags-padding-y);
    width: 100%;
    max-width: var(--tags-content-width);
  }

  .heading {
    margin-block-end: 1.5rem;
    font-weight: 700;
    font-size: 2.5rem;
    line-height: 1.2;
    font-family: var(--font-display);
    font-optical-sizing: auto;
  }

  /* -------------------------
   * Module — Tag List
   * Alphabetical list of tags with writing counts
   * ------------------------- */
  .tag-list {
    display: flex;
    flex-direction: column;
    gap: 1rem;
  }

  /* -------------------------
   * Module — Tag Link
   * Tag name left, count right; full-row click target
   * ------------------------- */
  .tag-link {
    display: flex;
    flex-direction: column-reverse;
    text-decoration: none;
  }

  .tag-name {
    display: block;
    color: var(--color-text);
    font-weight: 700;
    font-size: 1.5rem;
    line-height: 1.3333;
    font-family: var(--font-display);
    font-optical-sizing: auto;
  }

  .tag-count {
    display: block;
    margin-block-end: 0.25rem;
    color: var(--color-surface-700);
    font-size: 0.875rem;
    line-height: 1.21;
    white-space: nowrap;
  }

  /* -------------------------
   * State — Interactive
   * ------------------------- */
  .tag-link:link .tag-name {
    color: var(--color-text);
  }

  .tag-link:link .tag-name::before {
    margin-inline-end: 1px;
    content: "#";
  }

  .tag-link:visited .tag-name {
    color: var(--color-surface-400);
  }

  .tag-link:hover .tag-name,
  .tag-link:focus-visible .tag-name {
    color: var(--color-surface-600);
  }

  .tag-link:focus-visible {
    outline: 1px solid var(--color-border-hover);
    outline-offset: 0.5rem;
    border-radius: 0.125rem;
  }
</style>
