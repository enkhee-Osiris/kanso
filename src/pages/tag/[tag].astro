---
import { getCollection } from "astro:content";

import Head from "@/components/Head.astro";
import SkipLink from "@/components/SkipLink.astro";
import { TITLES, DESCRIPTIONS, URLS } from "@/constants";
import { getTagsWithWritings, getSortedWritings } from "@/utils/data";

export async function getStaticPaths() {
  const allWritings = await getCollection("writing");
  const sortedWritings = getSortedWritings(allWritings);

  const tagsWithWritings = getTagsWithWritings(sortedWritings);

  return tagsWithWritings.map(({ tag, writings }) => ({
    params: { tag },
    props: { tag, writings },
  }));
}

const { tag, writings } = Astro.props;
---

<!doctype html>
<html lang="en">
  <head>
    <Head title={TITLES.tag(tag)} description={DESCRIPTIONS.tag(tag)} />
  </head>

  <body>
    <SkipLink />
    <main id="main-content">
      <section class="writings" aria-label="Writings">
        <h2>{tag} - Writings</h2>

        <ul role="list">
          {
            writings.map(writing => (
              <li>
                <a href={URLS.writing(writing.id)}>{writing.data.title}</a>
              </li>
            ))
          }
        </ul>
      </section>
    </main>
  </body>
</html>
